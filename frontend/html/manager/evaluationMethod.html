<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    table {
      border-collapse: collapse;
      font-size: 20px;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 5px;
      width: 30%;
    }
    
  </style>
  </style>
</head>

<body>
  <h2>评价指标</h2>
  <div id="table"></div>
</body>
<script>
  var data = {
    tableHeader: { '指标类': 'name', '指标名': 'title', '可选项': 'options' },
    data: [{
			method: 'input',
			name: 'input',
			title:'对老师的评价',
			placeholder:'在这里填写评价内容'
		},{
			method: 'score',
			name: 'score',
			title:'老师的授课态度',
			options:['非常认真','认真','一般认真']
		},{
			method: 'radio',
			name: 'radio',
			title:'课题设计质量',
			options:['非常满意','满意','不满意']
		}, {
			method: 'checkbox',
			name: 'checkbox',
			title:'感受不错的方面',
			options:['课题设计','课堂氛围','随堂练习','知识复盘']
		}, {
			method: 'select',
			name: 'select',
			title:'对老师的评价5',
			options:['非常满意','满意','不满意']
		}]
  }
  function initTable() {
    var tableHtml = "<table><thead><tr>";
    for (var j in data.tableHeader) {
      tableHtml += "<th>" + j + "</th>";
    }
    tableHtml += "</tr></thead>";
    tableHtml += "</tr></thead><tbody>";
    tableHtml +="<tr>"
    tableHtml += `<td dataId='name'><select class="form-control" id="method1" required>
        <option value="input">input</option>
        <option value="score">score</option>
        <option value="checkbox">checkbox</option>
        <option value="radio">radio</option>
      </select></td>`
    tableHtml += `<td contenteditable='true' dataId='title'></td>`;
    tableHtml += `<td contenteditable='true' dataId='options'></td>`;
    tableHtml += `<td><button onclick='create(this)'}>添加</button></td>`;
    tableHtml += "</tr>";
    for (var i = 0; i < data.data.length; i++) {
      tableHtml += "<tr>";
      for (var j in data.data[i]) {
        if (j == 'method') {
          continue;
        }
        tableHtml += `<td idx=${data.data[i]['title']} dataId=${j} ondblclick="editCell(this)">` + data.data[i][j] + "</td>";
      }
      tableHtml += `<td><button onclick='remove(this)' idx=${data.data[i]['title']}>删除</button></td>`;
      tableHtml += "</tr>";
    }
    tableHtml += "</tbody></table>";
    document.getElementById("table").innerHTML = tableHtml;
  }
  
  function editCell(cell) {
    let originalContent = cell.innerHTML;
    cell.innerHTML = `<input type="text" value="${originalContent}" onblur="saveCell(this)">`;
    cell.firstChild.focus();
  }
  
  function saveCell(input) {
    let newValue = input.value;
    let cell = input.parentElement;
    cell.innerHTML = newValue;
    let dataId = cell.getAttribute('dataId');
    console.log(dataId)
    if(dataId!=='input'){
      let rowIdx = cell.parentElement.rowIndex - 2;
      newValue = newValue.split(',');
      console.log(rowIdx, dataId,newValue,data.data);
      data.data[rowIdx][dataId] = newValue;
      return
    }
    let rowIdx = cell.parentElement.rowIndex - 2;
    data.data[rowIdx].dataId = newValue;
    console.log(data);
    initTable();
  }
  
  initTable();
  function remove(btn) {
    let idx = btn.getAttribute('idx');
    data.data = data.data.filter(item => item.title != idx);
    initTable();
  }
  function create(btn) {
    //获取表单第一行数据
    let row = btn.parentElement.parentElement;
    console.log(row)
    let rowData = {};
    let method1 = document.getElementById('method1').value;
    rowData.method = method1;
    rowData.name = method1;
    for (let i = 1; i < row.children.length - 1; i++) {
      let cell = row.children[i];
      let dataId = cell.getAttribute('dataId');
      let cellValue = cell.innerHTML;
      if (cellValue == '') {
        alert('请输入数据');
        return;
      }
      rowData[dataId] = cellValue;
    }
    data.data.push(rowData);
    initTable();
  }
</script>

</html>