<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    table {
      border-collapse: collapse;
      font-size: 16px;
      margin: 20px auto;
      width: 80%;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      width: auto;
    }

    th {
      background-color: #f2f2f2;
      color: #333;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    button {
      padding: 5px 10px;
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }

    button:hover {
      background-color: #0056b3;
    }



    .editable-cell {
      padding: 0;
      height: 100%;
      box-sizing: border-box;
      outline: none;
      text-align: center;
    }
    .form-control {
      
      width: 100%;
      width: 100%;
      
      text-align: center;
      border: none;;
      font-size: 20px;
    }
  </style>
</head>

<body>
  <h2>评价指标</h2>
  <div id="table"></div>
</body>
<script>
  var data = {
    tableHeader: { '指标类': 'name', '指标名': 'title', '可选项': 'options' },
    data: [{
      method: 'input',
      name: 'input',
      title: '对老师的评价',
      placeholder: '在这里填写评价内容'
    }, {
      method: 'score',
      name: 'score',
      title: '老师的授课态度',
      options: ['非常认真', '认真', '一般认真']
    }, {
      method: 'radio',
      name: 'radio',
      title: '课题设计质量',
      options: ['非常满意', '满意', '不满意']
    }, {
      method: 'checkbox',
      name: 'checkbox',
      title: '感受不错的方面',
      options: ['课题设计', '课堂氛围', '随堂练习', '知识复盘']
    }, {
      method: 'select',
      name: 'select',
      title: '对老师的评价5',
      options: ['非常满意', '满意', '不满意']
    }]
  };

  function initTable() {
    var tableHtml = "<table><thead><tr>";
    for (var j in data.tableHeader) {
      tableHtml += "<th>" + j + "</th>";
    }
    tableHtml += "<th>操作</th></tr></thead><tbody>";

    // 表单行
    tableHtml += "<tr>";
    tableHtml += `<td data-id='name'><select class="form-control" id="method1" required>
        <option value="input">input</option>
        <option value="score">score</option>
        <option value="checkbox">checkbox</option>
        <option value="radio">radio</option>
      </select></td>`;
    tableHtml += `<td contenteditable='true' data-id='title' class='editable-cell'></td>`;
    tableHtml += `<td contenteditable='true' data-id='options' class='editable-cell'></td>`;
    tableHtml += `<td><button onclick='create(this)'>添加</button></td>`;
    tableHtml += "</tr>";

    // 数据行
    for (var i = 0; i < data.data.length; i++) {
      tableHtml += "<tr>";
      for (var j in data.data[i]) {
        if (j == 'method') {
          continue;
        }
        tableHtml += `<td idx=${data.data[i]['title']} data-id=${j} ondblclick="editCell(this)" class='editable-cell'>` + data.data[i][j] + "</td>";
      }
      tableHtml += `<td><button onclick='remove(this)' idx=${data.data[i]['title']}>删除</button></td>`;
      tableHtml += "</tr>";
    }
    tableHtml += "</tbody></table>";
    document.getElementById("table").innerHTML = tableHtml;
  }

  function editCell(cell) {
    cell.contentEditable = true;
    cell.classList.add('editable-cell');
    cell.focus();
  }

  function saveCell(cell) {
    cell.contentEditable = false;
    cell.classList.remove('editable-cell');
    let newValue = cell.textContent;
    let dataId = cell.getAttribute('data-id');
    let rowIdx = cell.parentElement.rowIndex - 2; // 考虑到表单行
    if (dataId === 'options') {
      newValue = newValue.split(',').map(option => option.trim());
    }
    data.data[rowIdx][dataId] = newValue;
    console.log(data);
  }

  function remove(btn) {
    let idx = btn.getAttribute('idx');
    data.data = data.data.filter(item => item.title !== idx);
    initTable();
  }

  function create(btn) {
    let row = btn.parentElement.parentElement;
    let rowData = {};
    let method1 = document.getElementById('method1').value;
    rowData.method = method1;
    rowData.name = method1;

    for (let i = 1; i < row.children.length - 1; i++) {
      let cell = row.children[i];
      let dataId = cell.getAttribute('data-id');
      let cellValue = cell.textContent;
      if (cellValue === '') {
        alert('请输入数据');
        return;
      }
      rowData[dataId] = cellValue;
    }
    data.data.push(rowData);
    initTable();
  }

  initTable();
</script>

</html>