<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    table {
      border-collapse: collapse;
      font-size: 16px;
      margin: 20px auto;
      width: 80%;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      width: auto;
    }

    th {
      background-color: #f2f2f2;
      color: #333;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    button {
      padding: 5px 10px;
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }

    button:hover {
      background-color: #0056b3;
    }

    .editable-input {
      width: auto;
      height: 100%;
      box-sizing: border-box;
      border: none;
      outline: none;
      text-align: center;
    }
  </style>
</head>

<body>
  <h2>教师管理</h2>
  <div id="table"></div>
</body>
<script>
  var data = {
    tableHeader: { '姓名': 'name', '性别': 'gender', '年龄': 'age', '课程': 'course' },
    data: [
      { id: 1001, name: "张三1", gender: "男", age: '20', course: '数学' },
      { id: 1002, name: "李四1", gender: "女", age: '11', course: '语文' },
      { id: 1003, name: "张三2", gender: "男", age: '16', course: '英语' },
      { id: 1004, name: "李四2", gender: "女", age: '18', course: '政治' },
      { id: 1005, name: "张三3", gender: "男", age: '14', course: '物理' },
      { id: 1006, name: "李四3", gender: "女", age: '18', course: '化学' },
      { id: 1007, name: "张三4", gender: "男", age: '21', course: '地理' },
    ],
  };

  function initTable() {
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const tbody = document.createElement('tbody');

    // 创建表头
    const headerRow = document.createElement('tr');
    for (const key in data.tableHeader) {
      const th = document.createElement('th');
      th.textContent = key;
      headerRow.appendChild(th);
    }
    const operationTh = document.createElement('th');
    operationTh.textContent = '操作';
    headerRow.appendChild(operationTh);
    thead.appendChild(headerRow);

    // 创建表单行
    const formRow = document.createElement('tr');
    for (const key in data.tableHeader) {
      const td = document.createElement('td');
      td.contentEditable = true;
      td.dataset.id = data.tableHeader[key];
      formRow.appendChild(td);
    }
    const addTd = document.createElement('td');
    const addButton = document.createElement('button');
    addButton.textContent = '添加';
    addButton.addEventListener('click', (e) => create(e.target));
    addTd.appendChild(addButton);
    formRow.appendChild(addTd);
    tbody.appendChild(formRow);

    // 创建数据行
    data.data.forEach((item) => {
      const row = document.createElement('tr');
      for (const key in item) {
        if (key === 'id') continue;
        const td = document.createElement('td');
        td.textContent = item[key];
        td.dataset.id = key;
        td.dataset.idx = item.id;
        td.addEventListener('dblclick', (e) => editCell(e.target));
        row.appendChild(td);
      }
      const deleteTd = document.createElement('td');
      const deleteButton = document.createElement('button');
      deleteButton.textContent = '删除';
      deleteButton.dataset.idx = item.id;
      deleteButton.addEventListener('click', (e) => remove(e.target));
      deleteTd.appendChild(deleteButton);
      row.appendChild(deleteTd);
      tbody.appendChild(row);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    document.getElementById('table').innerHTML = '';
    document.getElementById('table').appendChild(table);
  }

  function editCell(cell) {
    cell.contentEditable = true;
    cell.addEventListener('blur', (e) => saveCell(e.target));
    cell.focus();
  }

  function saveCell(cell) {
    cell.contentEditable = false;
    const newValue = cell.textContent;
    const dataId = cell.dataset.id;
    const rowIdx = cell.parentElement.rowIndex - 2; // 考虑到表单行
    data.data[rowIdx][dataId] = newValue;
    console.log(data);
  }

  function remove(btn) {
    const idx = btn.dataset.idx;
    data.data = data.data.filter(item => item.id !== parseInt(idx));
    initTable();
  }

  function create(btn) {
    const row = btn.parentElement.parentElement;
    const rowData = {};
    for (let i = 0; i < row.children.length - 1; i++) {
      const cell = row.children[i];
      const dataId = cell.dataset.id;
      const cellValue = cell.textContent;
      if (cellValue === '') {
        alert('请输入数据');
        return;
      }
      rowData[dataId] = cellValue;
    }
    rowData.id = generateUniqueID();
    data.data.push(rowData);
    initTable();
  }

  function generateUniqueID() {
    return Math.floor(Math.random() * 1000000) + 1001;
  }

  initTable();
</script>

</html>